<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notlar UygulamasÄ±</title>
</head>
<body>

  <!-- HTML iÃ§eriÄŸi buraya gelecek -->
  
  <!-- Firebase SDK ve uygulama kodunu modÃ¼l olarak ekliyoruz -->
  <script type="module">
    // Sayfa tamamen yÃ¼klendiÄŸinde bu iÅŸlev Ã§alÄ±ÅŸacak
    document.addEventListener("DOMContentLoaded", () => {
      console.log("BaÅŸlatÄ±ldÄ±!"); // Kontrol iÃ§in

      // Firebase SDK modÃ¼llerini import ediyoruz
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
      
      // Firebase yapÄ±landÄ±rma ayarlarÄ±
      const firebaseConfig = {
        apiKey: "AIzaSyArmR4InhjEbtMaQwYBB0gjnNlfX7gqn9Q",
        authDomain: "gizli-notlar-b505c.firebaseapp.com",
        projectId: "gizli-notlar-b505c",
        storageBucket: "gizli-notlar-b505c.firebasestorage.app",
        messagingSenderId: "6980096634",
        appId: "1:6980096634:web:0567ebd39bfa7a9c0821c3",
        measurementId: "G-9HSBXRNF69"
      };

      // Firebase'i baÅŸlatÄ±yoruz
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app); // Firestore veritabanÄ±na eriÅŸim saÄŸlÄ±yoruz

      // HTML Ã¶ÄŸelerini alÄ±yoruz
      const form = document.getElementById("noteForm");
      const input = document.getElementById("noteInput");
      const notesList = document.getElementById("notesList");

      // Form gÃ¶nderildiÄŸinde yapÄ±lacak iÅŸlem
      form.addEventListener("submit", async (e) => {
        e.preventDefault(); // Formun sayfa yeniden yÃ¼klemesini engelliyoruz
        const content = input.value.trim(); // KullanÄ±cÄ±nÄ±n girdiÄŸi notu alÄ±yoruz
        if (!content) return; // EÄŸer iÃ§erik boÅŸsa iÅŸlem yapmÄ±yoruz

        try {
          // Yeni notu Firestore veritabanÄ±na ekliyoruz
          await addDoc(collection(db, "notlar"), {
            text: content,
            created: serverTimestamp() // Notun oluÅŸturulma zamanÄ±nÄ± kaydediyoruz
          });
          console.log("âœ… Not baÅŸarÄ±yla eklendi:", content);
          input.value = ""; // Girdi kutusunu temizliyoruz
          await loadNotes(); // NotlarÄ± tekrar yÃ¼kle
        } catch (error) {
          console.error("âŒ Not eklenemedi:", error); // Hata durumunda hata mesajÄ±nÄ± yazdÄ±rÄ±yoruz
        }
      });

      // NotlarÄ± Firestore'dan yÃ¼kleme iÅŸlemi
      async function loadNotes() {
        notesList.innerHTML = ""; // Eski notlarÄ± temizliyoruz
        try {
          // "notlar" koleksiyonundaki verileri zaman sÄ±rasÄ±na gÃ¶re sÄ±ralÄ±yoruz
          const q = query(collection(db, "notlar"), orderBy("created", "desc"));
          const snapshot = await getDocs(q); // VeritabanÄ±ndan verileri alÄ±yoruz
          if (snapshot.empty) {
            notesList.innerHTML = "<p class='text-gray-400'>HenÃ¼z hiÃ§ not bÄ±rakÄ±lmamÄ±ÅŸ.</p>";
            return;
          }

          // NotlarÄ± ekrana yazdÄ±rÄ±yoruz
          snapshot.forEach(doc => {
            const data = doc.data(); // Veriyi alÄ±yoruz
            const p = document.createElement("div"); // Yeni bir <div> oluÅŸturuyoruz
            p.className = "bg-gray-800 p-3 rounded shadow"; // CSS sÄ±nÄ±flarÄ± ekliyoruz
            p.textContent = data.text || "(BoÅŸ iÃ§erik)"; // Ä°Ã§eriÄŸi yazÄ±yoruz, boÅŸsa "(BoÅŸ iÃ§erik)"
            notesList.appendChild(p); // <div>'i listeye ekliyoruz
          });

          console.log("ğŸ“¥ Notlar yÃ¼klendi, toplam:", snapshot.size); // Toplam not sayÄ±sÄ±nÄ± yazdÄ±rÄ±yoruz
        } catch (error) {
          console.error("âŒ Notlar yÃ¼klenemedi:", error); // Hata durumunda hata mesajÄ±nÄ± yazdÄ±rÄ±yoruz
        }
      }

      loadNotes(); // Sayfa yÃ¼klendiÄŸinde ilk defa notlarÄ± yÃ¼kle
    });
  </script>

</body>
</html>
